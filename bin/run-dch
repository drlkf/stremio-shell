#!/usr/bin/env bash

current="$1"
target="$2"

if ! { test -n "$current" && test -n "$target"; }; then
	echo >&2 "usage: $0 CURRENT TARGET"
	exit 1
fi

export DEBFULLNAME="$GIT_COMMITTER_NAME"
export DEBEMAIL="$GIT_COMMITTER_EMAIL"

if test -d debian; then
	while read -r line; do
		dch \
			--upstream \
			--newversion "$target" \
			"$line"
	done < <(git log "$current"..HEAD --pretty=format:%s$'\n')

	dch \
		--empty \
		--upstream \
		--newversion "$target" \
		--urgency medium \
		--distribution stable \
		''
fi
